name: simulate_dbs_variable

display_name: "Variable Simulate Database workloads"

summary:
  Do Bursty fio min 5s start background first. 500 IOP per guest

description: "Simulate a datacenter virtualization workload with a variety of workload types"

tags:
  - hackathon

estimated_runtime: 300

vars: 
    large_target_per_cluster:
        description: |
            How many Large VMs are there per node on average (16vCPU or more).
        display_name: Large VMs per host
        default: 5
        min: 1
    medium_target_per_cluster:
        description: |
            How many Medium VMs are there per node on average (4-16 vCPU).
        display_name: Medium VMs per host
        default: 10
        min: 1
    small_target_per_cluster:
        description: |
            How many Small VMs are there per node on average (1-4 vCPU).
        display_name: Small VMs per host
        default: 35
        min: 1        
vms:
  - vm:
      template: ubuntu1604
      vcpus: 2
      ram_mb: 2048
      data_disks:
        count: 3
        size: 1
      count_per_cluster: {{ large_target_per_cluster + medium_target_per_cluster + small_target_per_cluster }}

workloads: []

results: 
  - Response time:
      vm_group: vm
      result_type: latency
      result_hint: "Bursty IO Simulation"
      report_group: performance
      aggregate: mean
      report_metrics:
        - Variability
  - IOPS:
      vm_group: vm
      result_type: iops
      result_hint: "Bursty IO Simulation"
      report_group: performance
      aggregate: sum
      report_metrics:
        - Variability
      

setup:
  - cluster.CleanUp: {}
  - vm_group.CloneFromTemplate:
      vm_group_name: vm
  - vm_group.PowerOn:
      vm_group_name: vm


run:
  - playbook.Run:
      filename: runfio.yml
      variables:
        vms_per_cluster: {{ large_target_per_cluster + medium_target_per_cluster + small_target_per_cluster }}
        large_target_per_cluster:  {{ large_target_per_cluster }}
        medium_target_per_cluster:  {{ medium_target_per_cluster }}
        small_target_per_cluster:  {{ small_target_per_cluster }}
      inventory:
        - vm
      forks: 100
      remote_user: root
      remote_pass: nutanix/4u   


